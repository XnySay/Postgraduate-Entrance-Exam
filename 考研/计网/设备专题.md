## 物理层设备

### 中继器

![](./images/Pasted%20image%2020240915153542.png)

- **作用**:
  - 将信号整形并放大再转发出去，
  - 以消除信号经过一长段电缆后而产生的失真和衰减，
  - 使信号的波形和长度达到所需要的要求，进而扩大网络传输的距离
- **原理**:
  - <font color="#00b050">信号再生和还原，而非简单的信号放大</font>
  - 对比:
    - *中继器*：再生数字信号
    - *放大器*：放大模拟信号

- **注意事项**:
  - 放大器放大模拟信号，原理是将衰减的信号放大
  - 转发器也是物理层设备，可以放大信号
  - 中继器放大的是数字信号，原理是将衰减的信号整形再生

#### 端口功能

- 端口是中继器和外接计算机的一个硬件接口
- 中继器只有两个端口，数据从一个端口输入，经过中继器处理后从另一个端口输出
- 端口仅作用于信号的电气部分，不考虑数据的正确性或适用性（网段是否合适）

#### 应用

- 扩大网络规模的最简单廉价的互联设备，其两端的网络部分是网段
- **连接的几个网段仍然是一个局域网**
- 中继器若出现故障，会影响相邻两个网段的工作
- **不能连接两个具有不同速率的局域网**
- 中继器两端可以是不同的物理媒体，但一定是同一协议
- **注意**:
  - 具有**存储转发**功能的设备才能连接两个不同协议
  - **中继器没有存储转发功能，它两端的网段只能使用同一个协议**

#### 5-4-3 规则 【共享式以太网】

- 理论上可用无限个中继器，但实际受信号延迟范围限制
- **5-4-3 规则**:
  - 最多有 5 个网段、4 个中继器（或集线器），而其中 3 个网段可以连接计算机，剩余的 2 个是用于扩展距离的中继段（没有终端设备）

    ![](./images/Pasted%20image%2020240907190611.png)

### 集线器 (Hub)

![](./images/Pasted%20image%2020240915153743.png)

- **实质**: 多端口的中继器，只工作在物理层

- **作用**: 信号放大与广播，所有端口共享同一通信通道

- **信息传输的方向固定**:
  - 基于**星型拓扑结构**
  - 它接收到信号后，会**将信号放大并进行整形**，然后**广播**（转发到除了输入端口以外的所有端口）到所有其他连接的端口
  - 这种广播机制意味着所有连接到集线器的设备都会接收到相同的数据包，而不是根据数据包的目的地址进行选择性传输

- **特点**: Hub 是 **共享式设备**，在工作时所有端口共享同一通信通道

- **优点**:
  - **扩大网络的传输范围**

- **缺点**:
  - **不具备信号的定向传送能力**
  - **共享式网络**：逻辑上仍是一个总线网
  - Hub **只能在半双工状态下工作**，网络的吞吐率因此受到限制
  - 🌟Hub **不能分割冲突域**，连在集线器上的主机**平分（共享）带宽**
    - 例如: 带宽为 10 Mbps 的集线器，连接了 4 台主机，每台主机的带宽只有 2.5 Mbps
  - **信息碰撞**：多台机器经常需要同时通信，会导致信息碰撞，使得集线器的工作效率很差
  - 🌟Hub 的每个端口连接的网络部分是**同一个网络的不同网段**
  - 集线器的所有端口都属于同一个冲突域，集线器在一个时钟周期中只能传输一组信息

- **层级**：物理层
- **功能**：接收到一个端口的数据后，广播到所有端口
- **特点**：
  - 容易导致数据冲突和网络拥塞
  - 不区分数据的目标地址，简单地将数据广播给所有端口

| 共享式以太网                                 | 逻辑拓扑 | 物理拓扑 | 碰撞检测（由网卡负责） |
| -------------------------------------- | ---- | ---- | ----------- |
| 使用细**同轴电缆**的</br>**共享总线型**以太网          | 总线型  | 总线型  | CSMA/CD 协议  |
| 使用**集线器**和**双绞线**的</br>**星型拓扑的共享式**以太网 | 总线型  | 星型   | CSMA/CD 协议  |

## 数据链路层设备

### 以太网交换机

#### 基本概念

以太网交换机是一种用于连接多个网络设备（如计算机、打印机、服务器等）的网络设备
它通过在各个设备之间建立临时的通信路径，实现数据帧的高效转发
利用以太网交换机还可以方便地实现虚拟局域网（VLAN）
**VLAN 可以隔离冲突域和广播域**

### 交换机（Switch）

#### 优点

- 对工作站透明，管理开销低廉
- 简化了网络节点的增加、移动和网络变化的操作
- 方便地实现虚拟局域网 (VLAN)，VLAN 可以隔离冲突域，还可以隔离广播域

#### 特点

- 交换机的端口**与计算机或者交换机连接时**，通常工作在**全双工方式**【不使用 CSMA/CD 协议】
- 交换机的接口连接的是集线器时，接口就只能使用 CSMA/CD 协议并只能工作在半双工方式。
- 安装简单，具有**自学习能力**，通过自学习算法自动建立帧交换表
- 同时连通多对端口，无碰撞地传输数据
- **提高网络效率和安全性**：减少不必要的数据流量，提升网络效率和安全性
- **隔离冲突域**：每个端口是独立的冲突域，但不隔离广播域
- 独占传输媒体带宽，交换机总容量为 N×10 Mb/s
- **帧交换表**：记录**源 MAC 地址和接收端口信息**
- **转发表**：根据帧交换表转发数据帧
- 使用专用交换结构芯片，交换速率高
- **多速率端口组合**：支持多种速率的端口组合，满足不同用户需求
- 以太网交换机使用生成树协议 STP 消除网络环路

#### 工作原理

- **自学习**：记录**源** MAC 地址和端口信息，建立和更新 MAC 地址表
- 注意是<font color="#e36c09">*源 MAC 地址！源 MAC 地址！源 MAC 地址！*</font>
- **转发/过滤**：
  - 目标 MAC 地址在表中：换机将数据帧转发到与该地址对应的端口
  - 目标 MAC 地址不在表中：交换机将数据帧**泛洪**到除源端口外的所有端口，类似于广播
- **老化机制**：MAC 地址表会定期更新，**长时间未使用的 MAC 地址将被移除**，避免表项过多导致效率降低

- **MAC 地址的检测**：交换机检测数据帧的源和目标 MAC 地址，以决定如何处理数据

##### 泛洪（Flooding）

**泛洪**是交换机在无法确定目标 MAC 地址对应的端口时，采取的一种数据转发策略
主要用于未学习到目标 MAC 地址的情况下，确保数据到达目标设备

###### 泛洪的工作流程

> [! ] **泛洪机制的触发条件**：当交换机没有学习到目标设备的 MAC 地址时，会进行泛洪

1. **目标 MAC 地址在 MAC 表中**：
    - 交换机已学习到目标设备的 MAC 地址，直接将数据帧发送到对应端口

2. **目标 MAC 地址不在 MAC 表中**：
    - 交换机将数据帧泛洪到所有除接收端口外的端口，类似广播的方式发送
    - 目标设备收到帧并发送响应，交换机更新 MAC 地址表，将其 MAC 地址与端口对应
    - 此后，交换机可直接发送帧到正确的端口，不再进行泛洪

###### 泛洪的关键点

- 泛洪是一种**临时策略**，用于交换机未学到目标 MAC 地址时
- 泛洪并非真正的广播，尽管类似，但目的是为了学习目标设备的 MAC 地址
- 泛洪会带来一定的**网络负载**，但随着交换机不断学习 MAC 地址，泛洪次数会减少

#### 交换方式

##### 直通式交换机（cut-through）

- 只检查帧的**目的地址**，所以数据帧可以很快的被传输出去
  - 以太网的帧的目的地址占 6 B
- **优点**：只需要读取数据帧的目的地址，转发速度快，延迟低
- **缺点**：
  - 缺乏智能性和安全性 (不检查整个数据帧的完整性，不能检测数据帧的错误（如帧校验错误），因此可能导致错误数据的转发。)
  - 无法支持具有不同速率的端口的交换

##### 存储转发式交换机（store-and-forward）

- 缓存帧并检查数据，正确发送，发现帧错误丢弃
- **优点**：可靠性高，可以支持不同速率端口间的转换
- **缺点**：延迟较大

##### 例题

![](./images/Pasted%20image%2020241022102200.png)
![](./images/Pasted%20image%2020241022102213.png)
![](./images/Pasted%20image%2020241022102246.png)

### 网桥（Bridge）

![](./images/Pasted%20image%2020241022101655.png)

- **层级**：数据链路层
- **结构**
  - **接口管理软件**
  - **网桥协议实体**
  - **转发表**：存储网桥端口和 MAC 地址的映射关系
  - **缓存**：暂存发来的 MAC 帧
  - **接口**：网桥一般包含多个接口，每个接口连接一个网段
- **功能**：连接多个以太网，形成更大覆盖范围
- **特点**：隔离碰撞域，具有存储转发功能，互连不同网段

#### 转发情况

网桥根据帧的目的 MAC 地址和网桥的转发表对帧进行转发，包含以下三种情况：

- **明确转发**：网桥知道应当从哪个接口转发帧。
- **盲目转发**：网桥不知道应当从哪个接口转发帧，只能将其通过除进入网桥的接口外的其他所有接口转发。
- **丢弃**：网桥知道不应该转发该帧，将其丢弃。

> [! ] 注意事项
>
> - 如果网桥收到有**误码的帧**则直接**丢弃**。
> - 如果网桥收到一个**无误码的广播帧**，则不用进行查表，而是直接从除接收该广播帧的接口的**其他接口转发该广播帧**。
> - 转发表中的每条记录都有其**有效时间，到期自动删除**！这是因为各站点的 MAC 地址与网桥接口的对应关系并不是永久性的，例如某个站点更换了网卡，其 MAC 地址就会改变。

---
网桥的转发表通常由**自学习算法**得出，保存的内容 帧的<font color="#e36c09">源 MAC 地</font>址和进入<font color="#e36c09">网桥的接口号</font>。
![](./images/Pasted%20image%2020241022102959.png)

> MAC 帧的传输过程分析

> 主机 A 发送 MAC 帧：A -> D

![](./images/Pasted%20image%2020241022103134.png)

- **源 MAC 地址**: A，**目的 MAC 地址**: D
- **传输过程**：
    1. 主机 A 发送 MAC 帧到集线器，集线器将该帧发送给与其相连的主机 B 和 C
    2. 主机 B 和 C 发现该帧的目的 MAC 地址不是自己，遂丢弃
    3. MAC 帧到达网桥的端口 1，网桥查找转发表，发现目的 MAC 地址 D 应从端口 2 发出，于是将该帧从端口 2 转发
    4. 右侧集线器接收到 MAC 帧，并将其发送给主机 D、E 和 F
    5. 主机 E 和 F 发现目的 MAC 地址不是自己，遂丢弃；主机 D 发现帧是发给自己的，遂接收

> 主机 A 发送 MAC 帧：A -> C

![](./images/Pasted%20image%2020241022103947.png)

- **源 MAC 地址**: A，**目的 MAC 地址**: C
- **传输过程**：
  1. 主机 A 发送 MAC 帧到左侧集线器，集线器将该帧发送给主机 B 和 C
  2. 主机 B 发现目的 MAC 地址不是自己，遂丢弃；主机 C 发现是发给自己的，遂接收
  3. 同时，集线器也将该帧发送到网桥的端口 1。网桥查找转发表，发现目的 MAC 地址 C 是连接到端口 1 的设备，因此不需要通过其他端口转发，网桥丢弃该帧

> 主机 A 发送 MAC 广播帧
 ![](./images/Pasted%20image%2020241022104025.png)

- **源 MAC 地址**: A，**目的 MAC 地址**: FF-FF-FF-FF-FF-FF（广播地址）
- **传输过程**：
    1. 主机 A 发送广播帧到左侧集线器，集线器将该帧广播给所有连接的主机 B 和 C
    2. 主机 B 和 C 发现该帧是广播帧，遂接收
    3. 广播帧到达网桥的端口 1，网桥不会查找转发表，而是将该广播帧从其他接口（端口 2）转发出去
    4. 右侧集线器接收该广播帧，并将其广播给主机 D、E 和 F
    5. 主机 D、E 和 F 发现该帧是广播帧，遂接收

- **集线器的工作机制**：简单转发，任何接收到的帧都会发给所有连接的主机
- **网桥的工作机制**：根据转发表决定是否转发帧；若帧目标在接收端口，帧会被丢弃
- **广播帧**：集线器和网桥都会将广播帧发送给所有连接的设备，所有主机都会接收

#### 透明网桥的生成树协议 STP

![](./images/Pasted%20image%2020241022103742.png)
![](./images/Pasted%20image%2020241022103807.png)

## 网络层设备

### 路由器

- **定义**：路由器是一种具有**多个输入端口**和**多个输出端口**的专用计算机，其任务是**转发分组**
- **支持协议**：OSI、TCP/IP、IPX
- **功能**：根据分组的目的地，将其从合适的输出端口转发给下一跳路由器，直到分组到达终点

![](./images/Pasted%20image%2020240918182147.png)

- **网络层设备**：实现了物理层、数据链路层和网络层的功能

#### 数据传输

当源主机向目标主机发送数据报时，路由器先检查源主机与目标主机是否连接在同一个网络上

- 若源主机和目标主机在**同一个网络**上，则直接交付而无需通过路由器
- 若源主机和目标主机**不在同一个网络上**，则路由器按照转发表 (由路由表得出) 指出

#### 路由器结构

- **路由选择部分**（控制层面）
  - 包括：路由选择处理机、路由选择协议、路由表
  - **路由选择处理机**：根据**路由选择协议**构造和维护路由表

- **分组转发部分**（数据层面）
  - 由交换结构、一组输入端口和一组输出端口组成
  - **交换结构**：根据转发表处理分组，将其从合适的输出端口转发出去
    - 通过存储器进行交换
    - 通过总线进行交换
    - 通过互联网网络进行交换
  - **输入端口**：从物理层接收**比特流**，提取**数据链路层帧**，从帧中再提取**网络层数据报**
  - **输出端口**：将数据报变为比特流发送到物理层

![](./images/Pasted%20image%2020240918182346.png)
![](./images/Pasted%20image%2020240918182357.png)

#### 路由表与分组转发

![](./images/Pasted%20image%2020241020224715.png)

- **路由表**：根据路由选择算法得出，用于实现**路由选择。**
  - 标准路由表项目【四个】：
    - 目的网络 IP 地址
    - 子网掩码
    - 下一跳 IP 地址
    - 接口
- **转发**：根据转发表将收到的 IP 数据报从合适的端口转发出去，仅涉及一个路由器
- **路由选择**：涉及多个路由器，路由表是多个路由器协同工作的结果
- 默认路由的目的：
  - 减少转发表的重复项目
  - 使用一个默认路由代替所有具有相同下一跳的项目

#### 示例

![](./images/Pasted%20image%2020240907185939.png)

R1 的路由表如下：

| **目的网络 IP 地址** | **子网掩码**      | **下一跳 IP 地址** | **接口** |
| -------------- | ------------- | ------------- | ------ |
| 202.114.1.0    | 255.255.255.0 | 直接网络无下一跳      | E1     |
| 202.114.2.0    | 255.255.255.0 | 直接网络无下一跳      | L0     |
| 202.114.3.0    | 255.255.255.0 | 202.114.2.2   | L0     |
| 0.0.0.0        | 0.0.0.0       | 202.114.2.2   | L0     |

- **转发表**：从路由表得出，优化查找过程，包含目的地址和下一跳（MAC 地址）
  - 使用默认路由减少重复项目，优先级低于其他项目

- **实现**：
  - 路由表：用软件实现
  - 转发表：可用软件或特殊硬件实现

![](./images/Pasted%20image%2020240907185949.png)
![](./images/Pasted%20image%2020240915134747.png)

## 小结

### 集线器（Hub）和交换机（Switch）的区别

- **工作层级**:
  - **集线器**：工作在**物理层**，负责电信号的传递
  - **交换机**：工作在**数据链路层**，能够根据数据帧的**MAC 地址**转发数据

- **传输机制**:
  - **集线器**：采用**广播机制**，所有数据包被发送到所有端口，容易产生数据碰撞，网络效率低
  - **交换机**：采用**点对点传输机制**，根据 MAC 地址表定向转发数据，减少不必要的广播

- **带宽分配**:
  - **集线器**：端口共享带宽，所有设备平均分配总带宽，传输速度慢
  - **交换机**：每个端口独享带宽，提高了网络传输效率

- **冲突域和广播域**:
  - **集线器**：所有端口共享一个冲突域，且共享一个广播域
  - **交换机**：每个端口属于独立的冲突域，但所有端口共享一个广播域
![](./images/Pasted%20image%2020241022101306.png)
![](./images/Pasted%20image%2020241022101335.png)
![](./images/Pasted%20image%2020241022101402.png)
![](./images/Pasted%20image%2020241022101416.png)
![](./images/Pasted%20image%2020241022101829.png)
![](./images/Pasted%20image%2020241022101842.png)

### 交换机（Switch）与网桥（Bridge）的区别

- **实现方式**:
  - **交换机**：硬件实现，具有多个端口，支持多点通信
  - **网桥**：通常为软件实现，连接两个局域网段，隔离冲突域

- **连接方式**:
  - **交换机**：直接连接主机或其他网络设备，管理多个设备
  - **网桥**：用于连接两个局域网，形成更大覆盖范围

- **通信能力**:
  - **交换机**：允许多对设备同时通信，带宽利用率高
  - **网桥**：只允许两个网段间的设备同时通信，处理能力有限

- **转发机制**:
  - **交换机**：支持**存储转发**和**直通转发**模式，处理数据效率更高
  - **网桥**：采用存储转发模式，将数据帧接收后再进行转发

### 路由器（Router）与网桥（Bridge）的区别

- **网络层级**:
  - **网桥**：工作在**数据链路层**，处理 MAC 地址的数据帧转发
  - **路由器**：工作在**网络层**，根据 IP 地址进行分组转发，连接不同的网络

- **面向协议**:
  - **网桥**：不关心网络层协议，只处理局域网中的数据帧
  - **路由器**：面向不同协议，根据网络层地址（IP 地址）进行转发，支持多种协议（如 IP、TCP/IP 等）

- **功能**:
  - **网桥**：主要用于隔离冲突域，扩展局域网，不支持路径选择
  - **路由器**：支持**路径选择**、**分段**、**数据包生存时间管理**、**流量控制**，并可隔离广播域，连接多个不同网络

---

- **路由器的路径选择功能**：通过路由表计算最优路径，将数据包发送到正确的目标网络
- **路由器隔离广播域**：广播域的分隔减少了不必要的网络广播，提升了整体网络性能

### 冲突域与广播域

![](./images/Pasted%20image%2020240923150350.png)

- **冲突域（碰撞域）**：
  - 同一物理链路中的设备共享通信介质，数据帧可能发生冲突
  - 集线器无法隔离冲突域，交换机可以将每个端口分配独立的冲突域

- **广播域**：
  - 一块网卡发出一个广播时，能收到这个广播的所有网卡的集合。通常一个局域网 (LAN) 是一个广播域
  - **集线器和交换机**共享同一广播域，所有设备都会接收到广播
  - **路由器**能隔离广播域，防止广播数据在网络中泛滥，控制网络流量

#### 设备隔离域的能力

- **集线器**：不隔离冲突域和广播域
- **网桥/交换机**：隔离冲突域，但不隔离广播域
- **VLAN**：隔离广播域
- **路由器**：隔离冲突域和广播域【成本较高】

  - 路由器相连的其中一个接口的子网发出广播数据报，路由器不能进行转发

| 设备名称                           | 能否隔离冲突域 | 能否隔离广播域 |
| ------------------------------ | ------- | ------- |
| 物理层设备【傻瓜】<br/>(中继器、集线器) Hub   | ❌       | ❌       |
| 链路层设备【路人】<br/>(网桥、交换机) Switch | ✅       | ❌       |
| 网络层设备【大佬】<br/>路由器             | ✅       | ✅       |

### 例题

![](images/Pasted%20image%2020241006160948.png)
![](images/Pasted%20image%2020241006161246.png)
![](images/Pasted%20image%2020241006161303.png)
![](./images/Pasted%20image%2020241022101135.png)
![](./images/Pasted%20image%2020241022101102.png)
![](./images/Pasted%20image%2020241022101037.png)

## 数据链路层 - 转发表

- **转发表**存在于交换机中，是交换机转发数据帧的依据
- 交换机通过**自学习功能**生成转发表，学习源 MAC 地址并记录对应端口，从而确定帧的目的地址所在端口，完成高效转发

![](images/Pasted%20image%2020240928233204.png)

#### 有线局域网和无线局域网帧的转换

![](./images/Pasted%20image%2020240907180203.png)

> [! ] 站点 A 发送给同一子网的站点 B

> A → AP

- 帧控制字段 " 去往 AP=1,来自 AP=0 "

- 地址 1：接收地址（AP 的地址 BSSID）
- 地址 2：发送地址（站点 A 的地址 $MAC_A$）
- 地址 3：目的地址（站点 B 的地址 $MAC_B$）

> AP → B

- 帧控制字段 " 去往 AP=0 " 而 " 来自 AP=1 "

- 地址 1：接收地址（站点 B 的地址 $MAC_B$）
- 地址 2：发送地址（接入点 AP 的地址 BSSID）
- 地址 3：源地址（站点 A 的地址 $MAC_A$）

> [! ] 站点 A 发送给不同子网的站点 B，通过路由器转发

![](./images/Pasted%20image%2020240907180215.png)

> A → $AP_1$ 的 802.11 数据帧首部（去往 AP=1，来自 AP=0）

- 地址 1：接收地址（$AP_1$ 的地址 $BSSID_1$）
- 地址 2：发送地址（站点 A 的地址 $MAC_A$）
- 地址 3：目的地址（路由器 R 接口 1 的地址 $MAC_R-1$）

> $AP_1$ → R  802.11 帧 → 802.3 帧：

- 目的地址：$MAC_R-1$
- 源地址：$MAC_A$

路由器 R 收到 802.3 帧后，剥去首部和尾部，上交给网络层。
网络层根据 IP 数据报首部中的目的地址 $IP_B$ 查找转发表，知道应从接口 2 转发给地址为 $IP_B$ 的设备。
再使用 ARP，获得此设备的硬件地址 $MAC_B$
接入点 $AP_2$ 收到 802.3 帧，将其转换为 802.11 帧，帧控制字段中，" 去往 AP=0 " 而 " 来自 AP=1 "

![](./images/Pasted%20image%2020240907180220.png)

> $AP_2$ → B 的 802.11 帧首部

地址 1：接收地址（即目的地址）是站点 B 的地址 $MAC_B$
地址 2：发送地址是 $AP_2$ 的地址 $BSSID_2$
地址 3：源地址（不是发送地址）是路由器 R 接口 2 的地址 $MAC_R-2$

### 小结

- **有线局域网（802.3）帧**：用于有线以太网，包含源地址和目的地址两个地址字段
- **无线局域网（802.11）帧**：用于无线网络，包含接收地址、发送地址、目的地址和源地址四个地址字段，并通过帧控制字段确定地址的具体用途。

- **帧控制字段**：包含 " 去往 AP " 和 " 来自 AP " 两个位，用于指示帧是发送给 AP 还是由 AP 转发。
  - *去往 AP=1*：表示帧是发送给 AP 的。
  - *来自 AP=1*：表示帧是由 AP 转发的。

|    数据帧方向    | 地址 1<br>（接收地址） | 地址 2<br>（发送地址）|       地址 3       |
| :---------: | :------------: | :------------: | :--------------: |
| **站点 → AP** | AP 的地址（BSSID）|  站点的地址（MAC_A）| 目的地址（目的节点的 MAC）|
| **AP → 站点** | 目的站点的地址（MAC_B）| AP 的地址（BSSID）| 源地址（源站点的 MAC 地址）|

> [! ] MAC 层地址（如接收地址、发送地址、源地址、目的地址）在不同的帧转换步骤中通常会变化，而 网络层的源 IP 和目的 IP 地址保持不变

**源 IP 地址和目的 IP 地址**：
在整个数据传输过程中（无论是 A 到 AP，再到 R，还是最终到站点 B），**IP 层的数据不会被修改**。源 IP 和目的 IP 始终保持原始的发送端和接收端的 IP 地址不变。

- **源 IP 地址**：始终是站点 A 的 IP 地址 IPAIP_AIPA​
- **目的 IP 地址**：始终是站点 B 的 IP 地址 IPBIP_BIPB​

## 网络层

### ARP 表

- 是 ARP 协议中的表
- 实现了 IP 地址到 MAC 地址的转换
- 存在于主机和路由器之间
- 内容
 ![](./images/Pasted%20image%2020240907185608.png)

#### ARP 工作步骤

1. 主机 A 首先查看自己的 ARP 表（即 ARP 缓存表），确定是否有主机 B 的 IP 地址对应表项。如果有，则直接使用表项中的 MAC 地址进行封装，封装成帧后发送给主机 B
![](./images/Pasted%20image%2020240907185620.png)
2. 主机 A 在其 ARP 缓存中查找目标 IP 地址。如果找到匹配的 MAC 地址，则直接使用。如果没有找到，主机 A 会发送一个 ARP 请求**广播**到局域网。ARP 请求帧目标 MAC 地址字段为 `FF-FF-FF-FF-FF-FF` 这就是 **ARP 请求报文**
![](./images/Pasted%20image%2020240907185624.png)
3. **ARP 请求是广播报文**，同一个网段的所有主机都能收到。只有主机 B 发现报文中的目的 IP 地址是自己，于是主机 B 发送响应报文给主机 A，源 MAC 地址和源 IP 地址是主机 B，目的 MAC 地址和目的 IP 地址是主机 A，这个报文就叫 **ARP 响应报文**。同时，主机 B 的 ARP 表记录主机 A 的映射关系，即主机 A 的 IP 地址和 MAC 地址的对应关系
![](./images/Pasted%20image%2020240907185631.png)
4. 主机 C 也收到了 ARP 请求报文，但目的 IP 地址不是自己，所以不会进行响应。于是主机 C 添加主机 A 的映射关系到 ARP 表，并丢弃 ARP 请求报文
![](./images/Pasted%20image%2020240907185637.png)
5. 主机 A 收到 ARP 响应报文后，添加主机 B 的映射关系，同时用主机 B 的 MAC 地址做为目的地址封装成帧，并发送给主机 B
![](./images/Pasted%20image%2020240907185641.png)

![](images/Pasted%20image%2020240928233935.png)

### 路由表

- 路由表是路有选择处理机通过路由选择协议得出
- 路由表需要**对网络拓扑变化计算最优化**
- 转发表由路由表得出，转发表的结构应使查找过程最优化
