## Flynn 分类方式

### SISD(单指令流单数据流)

- 特性:
  - 各指令序列 **只能并发，不能并行**，每条指令 **同时处理一个数据**。
  - 这种结构**不具备并行性**，即没有数据级并行能力。
- 硬件组成:

    ![](images/Pasted%20image%2020240913125219.png)
  - 一个处理器 + 一个主存储器
  - *若采用指令流水线，需多个功能部件，采用多模块交叉存储器*

### SIMD(单指令流多数据流)

- 特性:
  - 多指令序列 **只能并发，不能并行**，但每条指令可 **同时处理很多相同特征数据**
  - 是 **一种数据级并行技术**
- 硬件组成:
    ![](images/Pasted%20image%2020240913125226.png)
  - 一个指令控制部件 (CU)+ 多个处理单元/执行单元（PU）+ 多个局部存储器 + 一个主存储器
  - 每个执行单元有各自寄存器组、局部存储器、地址寄存器
  - 但整体只有一个程序计数器 `PC`
  - *不同执行单元执行同一条指令，不同数据*

### MISD(多指令流单数据流)

- MISD 是指同时执行多条指令，处理同一个数据，实际上不存在这样的计算机

### MIMD(多指令流多数据流)

- 特征:
  - 各指令序列 **并行执行**，分别处理多个不同数据
  - 是一种 **线程级并行，甚至线程级以上的并行技术。**
- 分类:

#### **多处理器系统** (共享内存多处理器/多处理器系统/多核处理器)

- 特性
  - 各处理器之间，可以通过 `LOAD/STORE` 指令访问同一个主存储器，可通过主存相互传送数据
    - eg:Intel i5, i7
- 硬件组成:

 ![](images/Pasted%20image%2020240913125236.png)

- 一台计算机内包含 **多个处理器 + 一个主储存器**
- 多个处理器共享单一的物理地址空间

#### 多计算机系统

- 特性
  - 各计算机之间，不能通过 `LOAD/STORE` 指令直接访问对方存储器，只能通过 "**消息传递**" 相互传送数据
    - eg: 多台计算机组成的 "**分布式系统**"
- 硬件组成:

    ![](images/Pasted%20image%2020240913125242.png)

- 由多台计算机组成，因此拥有 **多个处理器 + 多个主存储器**
- 每台计算机 **拥有各自的私有存储器，物理地址空间相互独立**

#### 向量处理机 (SIMD 的扩展)

- 指令处理对象是 **向量**
- 主存储器采用 " 多端口同时读取 " 的交叉多模块存储器

- 硬件组成:
 ![](images/Pasted%20image%2020240913125247.png)

- 多个处理单元 + 多个 " 向量寄存器 "
- **主存储器应采用 " 多个端口同时读取 " 的交叉多模块存储器**
- 要有大容量的、集中式的主存储器，因为主存储器的大小限定了机器的解题规模
![](images/Pasted%20image%2020241022234955.png)

## 硬件多线程的基本概念

在传统 CPU 中，线程的切换包含一系列开销，频繁地切换会极大影响系统的性能，为了减少线程切换过程中的开销，便诞生了硬件多线程。在支持硬件多线程的 CPU 中，必须为每个线程提供单独的通用寄存器组、单独的程序计数器等，线程的切换只需激活选中的寄存器，从而省略了与存储器数据交换的环节，大大减少了线程切换的开销

 > 硬件多线程有 3 种实现方式:**细粒度多线程、粗粒度多线程和同时多线程 (SMT)。**

![](images/Pasted%20image%2020240913131653.png)

1. **细粒度多线程**：处理器每个时钟周期切换线程，指令并行度高。

   - 处理器在每个时钟周期切换线程，轮流交叉执行各个线程的指令，线程之间的指令可以并行、不相关。

   - 线程切换频率较高，但线程切换的开销较低，因为每个时钟周期都在切换，没有等待长时间的阻塞情况。
   - **优点**：避免长时间等待阻塞，提升流水线效率，适合较小阻塞或轻量级线程调度。
   - **缺点**：频繁切换可能带来调度开销，适合并行性较高的指令执行。

2. **粗粒度多线程**：在线程发生阻塞时进行切换，代价较大但减少了频繁切换的开销。

   - 线程只有在发生较大的阻塞（如 Cache 未命中）时才进行切换。流水线中发生的阻塞需要清除，新的线程执行前需要重新加载流水线。

   - 线程切换频率较低，通常是在出现明显阻塞时才进行切换，开销较大。
   - **优点**：避免频繁切换，减少开销。
   - **缺点**：切换代价大，适用于较长时间的阻塞和少量线程的调度场景。

3. **同时多线程**：结合指令级并行和线程级并行，实现更高效的执行。

   - 在实现指令级并行的同时，也实现了线程级并行。一个时钟周期内，可以同时发射多个不同线程中的多条指令，达到更高的并行度。

   - **优点**：可以充分利用 CPU 的计算资源，在硬件支持的情况下实现更高效的多线程处理。
   - **缺点**：硬件实现复杂度较高，适合高并发场景和多线程的密集型任务。

<div style="page-break-after: always;"> </div>

|            | 细粒度多线程                        | 粗粒度多线程                               | 同时多线程 (SMT)              |
| ---------- | ----------------------------- | ------------------------------------ | ------------------------ |
| **指令发射**   | 轮流发射各线程的指令<br>（每个时钟周期发射另一个线程） | 连续几个时钟周期，均发射同一线程的指令序列，流水线阻塞时，切换另一个线程 | 一个时钟周期内，可以发射多个不同线程中的多条指令 |
| **线程切换频率** | 每个时钟周期切换一次线程                  | 只有流水线阻塞时才切换线程                        | NULL                     |
| **线程切换代价** | 低                             | 高，需要重载流水线                            | NULL                     |
| **并行性**    | 指令级并行，线程间不并行                  | 指令级并行，线程间不并行                         | 指令级并行，线程级并行              |

## 共享内存多处理器 (SMP)

**共享内存多处理器 (SMP)** 是指具有单一物理地址空间的多处理器架构，所有处理器通过共享存储器中的变量进行通信。每个处理器的地位是平等的，可以独立地完成同样的任务。
处理器可以通过存储器访问指令，访问存储器的任何位置。尽管共享同一个物理地址空间，它们可以在自己的虚拟地址空间中运行程序

> SMP 有两种主要类型：**统一存储访问 (UMA)** 和 **非统一存储访问 (NUMA)**

### 统一存储访问 (UMA)

**统一存储访问 (UMA)** 是指每个处理器对所有存储单元的访问时间大致相同，即访问时间与哪个处理器提出访存请求及访问哪个字无关

- 多处理器访问统一的内存空间，优先给 CPU 分配最接近的内存
- 运算扩展性差，有 Cache 一致性问题
- 主要用于 UMA 适用于**共享内存架构中的小型多处理器系统**
  - eg: 多核个人电脑或者服务器，所有处理器共享一个存储器
- 每个处理器的缓存副本需要保持一致性，以确保多个处理器不会访问同一内存位置时产生不同的数据，这通过**缓存一致性协议**来实现
- 在 UMA 架构中，每个 CPU 的 Cache 都是共享内存中的一部分副本，因此还需考虑各 CPU 的 Cache 之间的一致性，即对于内存同一位置的数据，不同 CPU 的 Cache 不应该有不一致的内容

### 非统一存储访问 (NUMA)

**非统一存储访问 (NUMA)** 的运算扩展性强

- 某些存储器的访存速度要比其他的快，具体取决于哪个处理器提出访问请求及访问哪个字
- 主存被分割分配给了不同处理器
- 内存控制器被集成到 CPU 内部，每个 CPU 都有独立的内存控制器，独立连接到一部分内存，CPU 直连的这部分内存被称为本地内存
- 主要用于**大规模多处理器系统**，通过尽量访问本地内存优化性能。

## 多核处理器 (multi-core) 的基本概念

![](images/Pasted%20image%2020240913131728.png)

- 多核处理器是指将多个处理单元集成到单个 CPU 中，每个处理单元称为一个核 (core)
- 每个核既可以有自己的 Cache，也可以共享同一个 Cache。
- 所有核一般都是对称的，并且共享主存储器。因此多核属于共享存储的对称多处理器。
- 在多核计算机系统中，如要充分发挥硬件的性能，必须采用多线程 (或多进程) 执行，使得每个核在同一时刻都有线程在执行

> [! ] 与单核上的多线程的区别
>
> - 多核上的多个线程是在物理上并行执行的，是真正意义上的并行执行，在同一时刻有多个线程在并行执行。
> - 单核上的多线程是种多线程交错执行，实际上在同一时刻只有一个线程在执行

### 超线程技术

- 能够把一个物理处理器在软件层变成两个逻辑处理器
- 需要芯片组的支持才能发挥技术优势
