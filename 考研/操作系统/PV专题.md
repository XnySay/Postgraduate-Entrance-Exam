## 相关概念

信号量是一个整数，用于表示资源的可用情况。设信号量为 S：

- **S ≥ 0**：表示可供并发进程使用的资源实体数
- **S < 0**：表示正在等待使用临界区的进程的个数

P 操作和 V 操作是不可中断的程序段，称为原语：

- **P 原语**（Passeren，荷兰语，意为 pass）：
  1. S 减 1；
  2. 若 S ≥ 0，则进程继续执行；
  3. 若 S < 0，则进程被阻塞并进入与该信号相对应的队列，然后转进程调度

- **V 原语**（Verhoog，荷兰语，意为 increment）：
  1. S 加 1；
  2. 若 S > 0，则进程继续执行；
  3. 若 S ≤ 0，则从该信号的等待队列中唤醒一个等待进程，然后再返回原进程继续执行或转进程调度

---

- P,V 操作是原语操作，对于每一个进程来说，都只能进行一次
- P,V 操作必须成对使用
- 在 P,V 原语执行期间不允许有中断发生

## 流程

## 模板

### 同步

![同步](images/Pasted%20image%2020240927030629.png)

### 互斥

![互斥](images/Pasted%20image%2020240927030632.png)

## PV

### 生产者 - 消费者（同步、互斥）问题

![](./images/Pasted%20image%2020241030184533.png)
生产者一消费者问题 (producer-consumer problem) 是指若干进程通过有限的共享缓冲区交换数据时的缓冲区资源使用问题

**问题描述**：假设 " 生产者 " 进程不断向共享缓冲区写人数据 (即生产数据)，而 " 消费者 " 进程不断从共享缓冲区读出数据 (即消费数据)；共享缓冲区共有 n 个；任何时刻只能有一个进程可对共享缓冲区进行操作。所有生产者和消费者之间要协调，以完成对共享缓冲区的操作

![](images/Pasted%20image%2020241015205048.png)
**互斥关系**：缓冲区必须互斥访问：`mutex = 1`
**同步关系**：先生产，再消费：`empty = n，full = 0`

1. `full`：已被填充的缓冲区块数量，初值为 0
2. `empty`：空的缓冲区块数量，初值为 `n`（缓冲区总大小）
3. `mutex`：用于确保对缓冲区的互斥访问，初值为 1
![生产者 - 消费者](images/Pasted%20image%2020240927030706.png)

### 读者 - 写者问题

读者 - 写者问题（Reader-Writer Problem）描述了如何协调多个进程对共享数据区的访问，其中一些进程只读数据（读者），另一些进程修改数据（写者）。要求实现以下约束：

1. 任意多个读者可以同时读取数据
2. 只能有一个写者写数据，并且写者写数据时，其他进程不能读写
3. 写者优先时，若有写者在等待写数据，读者必须等待

- **读优先**：读者拥有更高的优先权。如果有多个读者在读，其他读者可以直接加入，无需等待写者完成
- **写优先**：写者拥有更高的优先权。如果有写者等待写操作，即使当前没有写者在写，读者也必须等待写者完成操作

- `rw_mutex`: 控制对共享资源的写访问，确保一次只能有一个写者访问，初值为 1
- `mutex`: 控制对读者计数器的互斥访问，防止多个读者同时修改计数器，初值为 1
- `read_count`: 记录当前正在读的读者数

#### 读优先

- 写者和读者都互斥工作

![](images/Pasted%20image%2020241015213741.png)

#### 写优先

![](images/Pasted%20image%2020241015214222.png)

### 哲学家问题

(由 Dijkstra 首先提出并解决)5 个哲学家围绕一张圆桌而坐，桌子上放着 5 支筷子，每两个哲学家之间放一支；哲学家的动作包括思考和进餐，进餐时需要同时拿起他左边和右边的两支筷子，思考时则同时将两支筷子放回原处。如何保证哲学家们的动作有序进行？如：不出现相邻者同时要求进餐；不出现有人永远拿不到筷子；

#### 法一

![法一](images/Pasted%20image%2020240927031127.png)

- 至多只允许有 4 位哲学家同时去拿左右边的筷子，最终能保证至少有一位哲学家能够进餐，并且能释放出他用过的两根筷子，从而使更多的哲学家能够进餐

#### 法二

![法二](images/Pasted%20image%2020240927031142.png)

- 仅当哲学家的左、右两只筷子均可用时，才允许他拿起筷子进餐

#### 法三

![法三](images/Pasted%20image%2020240927031149.png)

- 奇数号哲学家先拿左筷子，然后拿右筷子
- 偶数号哲学家相反
- 这样最后总会有一位哲学家能够将两只筷子而进餐

### 吸烟者问题

三个吸烟者在一间房间内，还有一个香烟供应者。为了制造并抽掉香烟，每个吸烟者需要三样东西：烟草、纸和火柴。供应者有丰富的货物提供。三个吸烟者中，第一个有

自己的烟草，第二个有自己的纸，第三个有自己的火柴。供应者将两样东西放在桌子上，允许一个吸烟者进行对健康不利的吸烟。当吸烟者完成吸烟后唤醒供应者，供应者再放两样东西（随机地）在桌面上，然后唤醒另一个吸烟者。试为吸烟者和供应者编写程序解决问题

供应者 seller 随即产生两样东西，提供它们，这里用普通变量来表示

k 吸烟者进程 smoker 根据其排号不同，拥有不同的一件东西。假设 1 号吸烟者拥有烟草 tobacco，2 号吸烟者拥有纸 paper，3 号吸烟者拥有火柴 match。其他号码错误返回

k 吸烟者的序号代表他们拥有的东西，用他们的序号和供应者产生的两样东西比较，如果都不相等，则说明他拥有的东西和供应者产生的东西匹配，它可以吸烟。如果其中一个相等，则推出，继续排队

k mutex 信号量代表一个只能进入的门，每次只有一个吸烟者可以进入进行比较和吸烟

k 每个吸烟者在吸烟完毕之后出门之前要叫醒供应者，调用 seller

### 理发师问题

理发店理有一位理发师、一把理发椅和 n 把供等候理发的顾客坐的椅子如果没有顾客，理发师便在理发椅上睡觉一个顾客到来时，它必须叫醒理发师如果理发师正在理发时又有顾客来到，则如果有空椅子可坐，就坐下来等待，否则就离开
